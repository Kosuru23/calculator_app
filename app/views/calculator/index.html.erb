<h1>Calculator</h1>

<%= form_with url: root_path, method: :post, local: true, data: { turbo: false }, id: "calc-form" do %>
  <%= text_field_tag :expression, params[:expression], id: "expression", size: 30, autocomplete: "off" %><br><br>

  <div id="calculator-buttons" style="display: grid; grid-template-columns: repeat(4, 60px); gap: 10px;">
    <% ["7", "8", "9", "+",
        "4", "5", "6", "-",
        "1", "2", "3", "*",
        "0", ".", "(", "/",
        ")", "^", "%", "C",
        "="].each do |btn| %>
      <button type="button" onclick="handleClick('<%= btn %>')"><%= btn %></button>
    <% end %>
  </div>
<% end %>

<% if defined?(@result) %>
  <h2>Result: <%= @result %></h2>
<% end %>

<script>
  const input = document.getElementById("expression");
  const form = document.getElementById("calc-form");

  function handleClick(value) {
    if (value === "=") {
      form.submit();
    } else if (value === "C") {
      input.value = "";
    } else {
      input.value += value;
      input.focus(); // Keep focus so keyboard input still works
    }
  }

  // ðŸ§  Listen for Enter key to submit
  input.addEventListener("keydown", function(e) {
    if (e.key === "Enter") {
      e.preventDefault();
      form.submit();
    }
  });
</script>